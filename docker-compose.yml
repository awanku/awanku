version: '3'
services:
  nginx:
    image: nginx:1.19
    volumes:
      - ./docker/nginx/site.conf:/etc/nginx/conf.d/default.conf
    ports:
      - 80:80
  core-api:
    build:
      context: ./backend
      dockerfile: Dockerfile
  console-webui:
    build:
      context: ./console
      dockerfile: Dockerfile
    command: nodemon --watch ./package.json --watch ./start.sh --exec ./start.sh
    working_dir: /app/console
    volumes:
      - ./console:/app/console
      - cache-yarn:/app/cache/yarn
    environment:
      - YARN_CACHE_FOLDER=/app/cache/yarn
  landing-webui:
    build:
      context: ./landing
      dockerfile: Dockerfile
    command: nodemon --watch ./package.json --watch ./start.sh --exec ./start.sh
    working_dir: /app/landing
    volumes:
      - ./landing:/app/landing
      - cache-yarn:/app/cache/yarn
    environment:
      - YARN_CACHE_FOLDER=/app/cache/yarn
volumes:
  cache-yarn: